# 作业
我们在数据库操作的时候，比如 dao 层中当遇到一个 sql.ErrNoRows 的时候，是否应该 Wrap 这个 error，抛给上层。为什么，应该怎么做请写出代码？

## 分析
错误处理有几个原则：
1、错误要被日志记录
2、应用程序处理错误，保证100% 完整性
3、之后不再报告当前错误。

根据这几点：
项目中
两点：1、这个方法你能处理 2、这个方法你不能处理

1、你要是处理就在当前方法这做这两件事：
完善错误信息，即不丢失信息
打错误日志
终止后续运行
2、 往错误信息添加当前方法(堆栈)信息，然后网上抛。
！！！不要打日志。

回到问题和工程本身，dao层是基础数据层，应该要跟业务解耦，不用关心哪个服务调我，因为我需要内聚。
所以那就回到dao层方法的设计，有些方法你需要处理，有些你要处理，取决于这个方法你期望外面调用的意图。
比如我们自己的项目（python 项目）我们在model的抽象服务会有作用类似但行为不类似的方法：
```python
def find_by_id(self, id, model_class):
    return self.query(model_class).filter(
        model_class.id == id
    ).first()

def force_find(self, id, model_class):
    item = self.find_by_id(model_class)
    if item is None:
        raise Exception(f"table [ {model_class.__table__} ] id not found: {id}")
    else:
        return item
```

这样的考虑是因为既然你和业务解耦，你也搞不清楚上面使用的场景。所以你就给他两个方案。当有时你必须要找到的时候，那找不到就把错抛出来呗。

当然可以统一给上层处理，但是可能写在抽象查找的话复用度更高，给服务提供更多的选择。

### 其他思考
工程中其实也有一些这种错误场景，比如一个注册场景，从某些活动入口或者投放入口进来的流量，
这时候的注册可能是我的活动服务(假设是A)去内部调用了我的用户服务(假设是B)的，那么会有这样的问题：
用户所有的流程都没问题，只是验证码输错了，这时候服务B返回我验证码错误，这时候我需要告诉用户。
但是这样的错误是什么类型呢？这其实是流程上正常的错误，查看日志可以忽略的，因为它不是我们server的bug，
它只是业务流程里正常可能出现的状况，针对这种情况，在我们的python项目中其实可以针对这种业务流程的异常定义一个类，
但凡认为这种流程错误就可以抛这个，那么在日志里看到这个类的错误就可以放心的忽略掉。
可能很多业务线中都可能会有这种类似的问题，那么如果不区分，让运维或者其它的开发，很难分辨哪些是我们服务的问题，哪些是业务流程正常的错误。

所以应该的期望是，我们在日志里看到堆栈信息，我们终止程序时暴露的信息不应该是堆栈信息，而是人类可读的信息。

#### 作业
回到作业，分析下。
- 如果是计数的方法，那么这个错误可能不构成错误，我们不妨对上层err抛为nil。
- 如果是获取list方法，不妨返回空数组？也可以对上层隐瞒err。
- 基于对之前项目遇见的问题思考，这里是否也要携带一下错误的类别和错误信息，做一个error 封装呢

- 当然在dao层基本无需去管调用方我们根据方法用途来做判断即可。

- 而且这一层从工程角度基本就是最下面了，所以1、要么抛，2、要么日志，中断程序。

[最后写写代码尝试一下](./week2_hw.go)
